
# 前言
受到全球疫情的影响，项目可能与计划中不同，但是不作为正式项目。
 
# 架构
## 1. 应用架构
### 1.1 在不同产品的实际应用中，功能复用现象时有发生，故为了增强产品实用性，部件可替代性，设计了一种特殊的应用架构模型。
 
硬件层也是物理层，是应用的基本硬件设备。驱动层负责将数字信号转换为硬件层需要的模拟信号，同时接收硬件层传输来的模拟信号转化为数字信号。通讯层是一个虚层，其规定数字信号和逻辑层之间的协议以及规定。逻辑层是负责应用的一个完整的生命周期。
对于该项目，我们将基于该架构模型规划我们的应用。
![应用框图](https://s2.loli.net/2022/05/10/1IBGHoeZUTMfXar.png)
基于该架构的硬件规划，可以生产出多可应用部署的结构性模块，节省资金以及研发费用。
 

### 1.2 应用的生命周期
一个应用具有以下生命周期，初始化INIT，事件EVENT，销毁DESTROY。
![生命周期](https://s2.loli.net/2022/05/10/K2hJH5OvqoVnUdS.png)
初始化阶段，驱动层首先初始化硬件，初始化完毕后逻辑层挂载相关驱动层。
事件阶段，逻辑层按照业务逻辑进行计算。由初始化结束触发。
销毁阶段，停机，逻辑层离线保存相关数据或进入初始化。由事件产生中断触发。

# 2. 电路规划
## 2.1 前置驱动电路
 
### 2.1.1 前置驱动电路控制部分
![控制部分](https://s2.loli.net/2022/05/10/pm1UjqFb8lkN5GY.png)
可以看出，这是一分临时随意的电路图，但是其功能完整性是不可否认的。
输入电压12V-功率输入 3.3V信号输入。可驱动2个刷式直流电机，6个舵机，8个灰度传感器模块。主控采用ST公司的STM32F103C8T6价格昂贵性价比不高。H桥芯片是AT8870，3.6A单通道刷式直流电机驱动IC。缓冲芯片选择SN74HC125PWR用作信号隔离。
通讯方式为UART串口通讯。带2个功能开关按键，1个可编程指示灯，3个电源指示灯。6个舵机通道输入，8个灰度传感器输入。提供一个IIC接口，设计接入0.96寸OLED显示屏。ADC1，ADC2分别可采集12V输入电压，BUCK输出电压。提供SW调试接口。
电源部分
 
### 2.1.2 前置驱动电路电源部分
![电源部分](https://s2.loli.net/2022/05/10/qvda6o4YreQch2g.png)
BUCK降压芯片选择MP2236，6A峰值电流，输出电压可调。
输出电压由以下公式指出。

$$ R_{13} = \frac {R_{17}} {\frac{V_{out}}{0.6} - 1}$$
当R17为100K，R13为10K时，输出电压为6.6V。
  
### 2.1.3 前置驱动电路PCB透视图
![正面](https://s2.loli.net/2022/05/10/vEx7642NWYHPFKI.png)
![底面](https://s2.loli.net/2022/05/10/Z3DKoyhTmrcpNxI.png)
以上为PCB布局图，可以看出PCB的布局虽然随意，但还是有奥妙所在。PCB为4层板，叠层顺序为TOP-GND-POWER-BOTTOM。表层铜厚1oz，内层铜厚0.5oz，板厚1.6mm。设计最大输入功率72W，板耗<2W。电机接头采用两个KF2EDG 3.08mm拔插式接线端子，12V供电采用一个KF2EDG 5.08mm拔插式接线端子。串口以及烧录接口使用MX1.25mm卧式针座连接器。拔插式设计，作为模型机方便利于调试。
